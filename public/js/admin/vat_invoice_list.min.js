layui.use(["form","layer","upload","table","laydate"],function(){$=layui.jquery;var f=layui.form;var c=layui.upload;var e=layui.table;var b={};var a=layui.laydate;var d=JSON.parse(localStorage.getItem("vatInvoiceList"));a.render({elem:"#invoice_date",range:true});a.render({elem:"#created_at",range:true});if(!d){d={id:true,file_id:true,invoice_type:false,invoice_type_org:true,invoice_code:false,invoice_num:false,check_code:false,invoice_date:false,purchaser_name:true,purchaser_register_num:true,purchaser_address:true,purchaser_bank:true,password:true,seller_name:true,seller_register_num:true,seller_address:true,seller_bank:true,total_amount:true,total_tax:true,amount_in_words:true,amount_in_figuers:false,payee:false,checker:false,note_drawer:false,remarks:false,created_at:false}}f.render();f.on("submit(sreach)",function(g){b=g.field;console.log(b);e.reload("exportTable",{where:b,page:{curr:1}});return false});e.on("toolbar()",function(g){console.log(g.event);if(g.event==="LAYTABLE_COLS"){$(".layui-table-tool-panel").click(function(){$(".layui-table-tool-panel li").each(function(j,h){d[$(h).find("input").attr("name")]=$(h).find(".layui-form-checked").length===0});localStorage.setItem("vatInvoiceList",JSON.stringify(d))})}});e.render({elem:"#table",id:"exportTable",limit:15,limits:[15,30,60,90],loading:true,toolbar:"#toolbarDemo",defaultToolbar:["filter"],where:b,url:"/admin/vatInvoice/list",page:true,cols:[[{field:"id",title:"ID",width:5,hide:d.id},{field:"invoice_num",title:"发票号码",hide:d.invoice_num},{field:"invoice_code",title:"发票代码",hide:d.invoice_code},{field:"file_id",title:"图片ID",hide:d.file_id},{field:"invoice_type",title:"发票种类",hide:d.invoice_type},{field:"invoice_type_org",title:"发票名称",hide:d.invoice_type_org},{field:"check_code",title:"校验码",hide:d.check_code},{field:"invoice_date",title:"开票日期",hide:d.invoice_date},{field:"purchaser_name",title:"购方名称",hide:d.purchaser_name},{field:"purchaser_register_num",title:"购方纳税人识别号",hide:d.purchaser_register_num},{field:"purchaser_address",title:"购方地址及电话",hide:d.purchaser_address},{field:"purchaser_bank",title:"购方开户行及账号",hide:d.purchaser_bank},{field:"password",title:"密码区",hide:d.password},{field:"seller_name",title:"销售方名称",hide:d.seller_name},{field:"seller_register_num",title:"销售方纳税人识别号",hide:d.seller_register_num},{field:"seller_address",title:"销售方地址及电话",hide:d.seller_address},{field:"seller_bank",title:"销售方开户行及账号",hide:d.seller_bank},{field:"total_amount",title:"金额",hide:d.total_amount},{field:"total_tax",title:"税额",hide:d.total_tax},{field:"amount_in_words",title:"价税合计(大写)",hide:d.amount_in_words},{field:"amount_in_figuers",title:"价税合计(小写)",hide:d.amount_in_figuers},{field:"payee",title:"收款人",hide:d.payee},{field:"checker",title:"复核",hide:d.checker},{field:"note_drawer",title:"开票人",hide:d.note_drawer},{field:"remarks",title:"备注",hide:d.remarks},{field:"created_at",title:"创建时间 ",hide:d.created_at},{field:"",title:"操作",templet:function(g){let html="<span onclick=\"xadmin.open('编辑','/admin/vat_invoice/edit?id="+g.id+'\')" class="layui-btn layui-btn-sm layui-btn-normal">修改</span>';html+='<span data-id="'+g.id+'" class="layui-btn layui-btn-sm layui-btn-danger del">删除</span>';return html},width:150}]],done:function(g,j,h){$("#total_amount").html(g.total_amount);$("#total_tax").html(g.total_tax);$("#amount_in_figuers").html(g.amount_in_figuers);var i=c.render({elem:"#test1",url:"/admin/file/upload",accept:"file",data:{type:1},acceptMime:"image/*,application/pdf",multiple:true,headers:header,allDone:function(k){console.log(k.total);console.log(k.successful);console.log(k.aborted);layer.alert("上传成功"+k.successful+"个文件",{icon:6},function(){location.reload()})},error:function(){}});$(".del").click(function(){let id=$(this).attr("data-id");layer.confirm("你确定要删除此数据吗？",{btn:["确定","取消"]},function(){$.post("/admin/vat_invoice/delete",{id:id},function(k){if(k.code===0){layer.msg("删除成功",{icon:1});e.reload("exportTable",{where:b,page:{curr:1}})}else{layer.msg("删除失败",{icon:2})}})})})}})});